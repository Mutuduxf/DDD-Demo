# BFF

---

## 说明

* BFF实际上是API网关的一种实践方式，由API网关衍生而来。

* API网关职责：

  1. 请求路由：API网关通过将请求路由到相应的服务来实现一些API操作。 当API网关接收到请求时，它会查询路由映射，该路由映射指定将请求路由到的服务。 路由映射可能例如将HTTP方法和路径映射到服务的HTTP URL。 此功能与Web服务器（如NGINX）提供的反向代理功能相同。

  2. API组合：将后台服务多个细粒度的API组合成一个相对大粒度的API，用于处理一个功能需要多次请求的情况，相当于设计模式中的**外观模式**。

  3. 协议转换：API网关也可能执行协议转换。 即使应用程序服务内部使用了包括REST和gRPC在内的多种协议，API网关也可能向外部客户端提供RESTful API。 需要时，一些API操作的实现会在RESTful外部API和基于内部gRPC的API之间进行转换。

  4. 实现边缘功能：

    * 尽管API网关的主要职责是API路由和组合，但它也可以实现所谓的边缘功能。 顾名思义，边缘功能是在应用程序边缘实现的请求处理功能。应用程序可能实现的边缘功能的示例包括：

      1. 身份验证–验证发出请求的客户端的身份   

      2. 授权–验证客户端是否有权执行特定操作   

      3. 速率限制–限制特定客户端和/或所有客户端每秒允许多少个请求   

      4. 缓存–缓存响应以减少对服务的请求数量   

      5. 指标收集–收集有关API使用情况的指标以用于计费分析   

      6. 请求记录–记录请求日志   

    * 应用程序中的三个不同位置允许您实现这些边缘功能。   

      1. 在后端服务中实现这些边缘功能：这对于某些功能（例如缓存，指标收集以及可能的授权）可能是有意义的，但是如果应用程序在边缘请求到达服务之前对其进行身份验证，则通常更为安全。   

      2. 在API网关上游的边缘服务中实现这些边缘功能：边缘服务是外部客户端的第一联系点。 它对请求进行身份验证并执行其他边缘处理，然后再将其传递到API网关。   

      3. 使用专用边缘服务：一个重要好处是它可以将关注点分开。 API网关专注于API路由和组成。 另一个好处是，它集中了对关键边缘功能（例如身份验证）的责任。当应用程序具有多个API网关（可能使用多种语言和框架编写）时，这特别有价值。 这种方法的缺点是由于额外的跳而增加了网络延迟。 这也增加了应用程序的复杂性。   

      因此，使用第三个选项并在API网关本身中实现这些边缘功能（例如授权）通常很方便。 网络跳数减少了一个，从而改善了延迟。 更少的活动部件降低了复杂性。

* API网关为每个客户端提供特定于客户端的API

  * API网关可以提供一个单一的万能（OSFA）API。 单个API的问题在于，不同的客户端通常具有不同的要求。 例如，第三方应用程序可能需要Get Order Details API操作来返回完整的Order details，而移动客户端仅需要数据的一部分。 解决此问题的一种方法是为客户提供在请求中指定服务器应返回哪些字段和相关对象的选项。 对于必须为广泛的第三方应用程序提供服务的公共API而言，这种方法就足够了，但通常无法为客户提供所需的控制权。

  * 对于API网关，一种更好的方法是为每个客户端提供自己的API。 例如，FTGO API网关可以为FTGO移动客户端提供专门设计用于满足其要求的API。 它甚至可能针对Android和iPhone移动应用程序具有不同的API。 API网关还实现了公共API，供第三方开发人员使用。